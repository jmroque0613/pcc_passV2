<!-- frontend/src/app/dashboard/admin-equipment/admin-equipment.component.html -->
<div class="equipment-wrapper">
  <!-- Header -->
  <div class="page-header">
    <button mat-icon-button (click)="goBack()" class="back-btn">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <div class="header-content">
      <h1><mat-icon>computer</mat-icon> Equipment Management</h1>
      <p>Manage IT equipment inventory and assignments</p>
    </div>
    <button mat-raised-button color="primary" (click)="showAddForm = !showAddForm; selectedEquipment = null; equipmentForm.reset({ condition: 'New', status: 'Available' })">
      <mat-icon>add</mat-icon>
      Add Equipment
    </button>
  </div>

  <!-- Success/Error Messages -->
  <div class="message-container" *ngIf="successMessage || errorMessage">
    <div class="success-alert" *ngIf="successMessage">
      <mat-icon>check_circle</mat-icon>
      <span>{{ successMessage }}</span>
    </div>
    <div class="error-alert" *ngIf="errorMessage">
      <mat-icon>error</mat-icon>
      <span>{{ errorMessage }}</span>
    </div>
  </div>

  <!-- Add/Edit Equipment Form -->
  <div class="form-card" *ngIf="showAddForm">
    <div class="form-header">
      <h3>
        <mat-icon>{{ selectedEquipment ? 'edit' : 'add_circle' }}</mat-icon>
        {{ selectedEquipment ? 'Edit Equipment' : 'Add New Equipment' }}
      </h3>
      <button mat-icon-button (click)="cancelForm()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <form [formGroup]="equipmentForm" (ngSubmit)="onSubmit()">
      <!-- Property Details Section -->
      <div class="form-section">
        <h4><mat-icon>description</mat-icon> Property Details</h4>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Property Number</mat-label>
            <input matInput formControlName="property_number" placeholder="PCC-2024-IT-001">
            <mat-error *ngIf="equipmentForm.get('property_number')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>GSD Code</mat-label>
            <input matInput formControlName="gsd_code" placeholder="GSD-IT-2024-001">
            <mat-error *ngIf="equipmentForm.get('gsd_code')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Item Number</mat-label>
            <input matInput formControlName="item_number" placeholder="IT-001">
            <mat-error *ngIf="equipmentForm.get('item_number')?.hasError('required')">Required</mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Equipment Information Section -->
      <div class="form-section">
        <h4><mat-icon>devices</mat-icon> Equipment Information</h4>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Equipment Type</mat-label>
            <mat-select formControlName="equipment_type">
              <mat-option *ngFor="let type of equipmentTypes" [value]="type">{{ type }}</mat-option>
            </mat-select>
            <mat-error *ngIf="equipmentForm.get('equipment_type')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Brand</mat-label>
            <input matInput formControlName="brand" placeholder="Dell">
            <mat-error *ngIf="equipmentForm.get('brand')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Model</mat-label>
            <input matInput formControlName="model" placeholder="Optiplex 7090">
            <mat-error *ngIf="equipmentForm.get('model')?.hasError('required')">Required</mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Serial Number</mat-label>
            <input matInput formControlName="serial_number" placeholder="SN123456789">
            <mat-error *ngIf="equipmentForm.get('serial_number')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Specifications (Optional)</mat-label>
            <textarea matInput formControlName="specifications" rows="2" placeholder="Intel i5, 8GB RAM, 256GB SSD"></textarea>
          </mat-form-field>
        </div>
      </div>

      <!-- Acquisition Details Section -->
      <div class="form-section">
        <h4><mat-icon>shopping_cart</mat-icon> Acquisition Details</h4>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Acquisition Date</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="acquisition_date">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="equipmentForm.get('acquisition_date')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Acquisition Cost (₱)</mat-label>
            <input matInput type="number" formControlName="acquisition_cost" placeholder="45000.00">
            <mat-error *ngIf="equipmentForm.get('acquisition_cost')?.hasError('required')">Required</mat-error>
            <mat-error *ngIf="equipmentForm.get('acquisition_cost')?.hasError('min')">Must be positive</mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Status & Condition Section -->
      <div class="form-section">
        <h4><mat-icon>info</mat-icon> Status & Condition</h4>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Condition</mat-label>
            <mat-select formControlName="condition">
              <mat-option *ngFor="let cond of conditions" [value]="cond">{{ cond }}</mat-option>
            </mat-select>
            <mat-error *ngIf="equipmentForm.get('condition')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Status</mat-label>
            <mat-select formControlName="status">
              <mat-option *ngFor="let stat of statuses" [value]="stat">{{ stat }}</mat-option>
            </mat-select>
            <mat-error *ngIf="equipmentForm.get('status')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Remarks (Optional)</mat-label>
            <textarea matInput formControlName="remarks" rows="2"></textarea>
          </mat-form-field>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button mat-button type="button" (click)="cancelForm()">Cancel</button>
        <button mat-raised-button color="primary" type="submit" [disabled]="loading">
          <mat-spinner *ngIf="loading" diameter="20" class="button-spinner"></mat-spinner>
          <span *ngIf="!loading">{{ selectedEquipment ? 'Update' : 'Add' }} Equipment</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Assign Equipment Dialog -->
  <div class="dialog-overlay" *ngIf="showAssignForm" (click)="cancelForm()">
    <div class="dialog-content" (click)="$event.stopPropagation()">
      <div class="dialog-header">
        <h3><mat-icon>person_add</mat-icon> Assign Equipment</h3>
        <button mat-icon-button (click)="cancelForm()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <form [formGroup]="assignForm" (ngSubmit)="onAssignSubmit()">
        <div class="dialog-body">
          <div class="equipment-info">
            <mat-icon>computer</mat-icon>
            <div>
              <strong>{{ selectedEquipment?.equipment_type }}</strong>
              <span>{{ selectedEquipment?.brand }} {{ selectedEquipment?.model }}</span>
              <span class="property-number">{{ selectedEquipment?.property_number }}</span>
            </div>
          </div>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Assign To User</mat-label>
            <mat-select formControlName="assigned_to_user_id">
              <mat-option *ngFor="let user of allUsers" [value]="user.id">
                {{ user.first_name }} {{ user.surname }} - {{ user.position }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="assignForm.get('assigned_to_user_id')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <!-- ✅ ADDED: Assignment Type Selection -->
          <div class="assignment-type-group">
            <label class="group-label">Assignment Type:</label>
            <mat-radio-group formControlName="assignment_type">
              <mat-radio-button value="PAR">PAR (Regular Employee)</mat-radio-button>
              <mat-radio-button value="Job Order">Job Order Assignment</mat-radio-button>
            </mat-radio-group>
          </div>

          <!-- ✅ ADDED: Conditional PAR Number Field -->
          <mat-form-field appearance="outline" class="full-width" *ngIf="assignForm.get('assignment_type')?.value === 'PAR'">
            <mat-label>PAR Number</mat-label>
            <input matInput formControlName="par_number" placeholder="Enter PAR number">
            <mat-error *ngIf="assignForm.get('par_number')?.hasError('required')">
              PAR number is required for PAR assignments
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Assignment Date</mat-label>
            <input matInput [matDatepicker]="assignPicker" formControlName="assigned_date">
            <mat-datepicker-toggle matSuffix [for]="assignPicker"></mat-datepicker-toggle>
            <mat-datepicker #assignPicker></mat-datepicker>
            <mat-error *ngIf="assignForm.get('assigned_date')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Previous Recipient (Optional)</mat-label>
            <input matInput formControlName="previous_recipient">
          </mat-form-field>

          <!-- ✅ ADDED: Info Box for Assignment Type -->
          <div class="info-box" [class.par]="assignForm.get('assignment_type')?.value === 'PAR'">
            <mat-icon>info</mat-icon>
            <div class="info-text">
              <strong *ngIf="assignForm.get('assignment_type')?.value === 'PAR'">PAR Assignment:</strong>
              <strong *ngIf="assignForm.get('assignment_type')?.value === 'Job Order'">Job Order Assignment:</strong>
              <p *ngIf="assignForm.get('assignment_type')?.value === 'PAR'">
                This equipment will be assigned with a Property Accountability Record (PAR). 
                The employee will be held accountable for this property.
              </p>
              <p *ngIf="assignForm.get('assignment_type')?.value === 'Job Order'">
                This is a temporary assignment for job order employees. 
                No PAR document is required.
              </p>
            </div>
          </div>
        </div>

        <div class="dialog-actions">
          <button mat-button type="button" (click)="cancelForm()">Cancel</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!assignForm.valid">Assign Equipment</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Equipment Table -->
  <div class="table-card">
    <div class="table-header">
      <h3><mat-icon>list</mat-icon> Equipment Inventory</h3>
      <div class="table-stats">
        <span class="stat-chip total">Total: {{ equipmentList.length }}</span>
        <span class="stat-chip available">Available: {{ (equipmentList | filter: 'status': 'Available').length }}</span>
        <span class="stat-chip assigned">Assigned: {{ (equipmentList | filter: 'status': 'Assigned').length }}</span>
      </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-container" *ngIf="loading">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading equipment...</p>
    </div>

    <!-- Equipment Table -->
    <div class="table-container" *ngIf="!loading">
      <table mat-table [dataSource]="equipmentList" class="equipment-table">
        <!-- Property Number Column -->
        <ng-container matColumnDef="property_number">
          <th mat-header-cell *matHeaderCellDef>Property Number</th>
          <td mat-cell *matCellDef="let element">
            <div class="property-cell">
              <strong>{{ element.property_number }}</strong>
              <span class="gsd-code">{{ element.gsd_code }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Equipment Type Column -->
        <ng-container matColumnDef="equipment_type">
          <th mat-header-cell *matHeaderCellDef>Equipment Type</th>
          <td mat-cell *matCellDef="let element">{{ element.equipment_type }}</td>
        </ng-container>

        <!-- Brand Column -->
        <ng-container matColumnDef="brand">
          <th mat-header-cell *matHeaderCellDef>Brand</th>
          <td mat-cell *matCellDef="let element">{{ element.brand }}</td>
        </ng-container>

        <!-- Model Column -->
        <ng-container matColumnDef="model">
          <th mat-header-cell *matHeaderCellDef>Model</th>
          <td mat-cell *matCellDef="let element">{{ element.model }}</td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let element">
            <mat-chip [class]="'status-' + element.status.toLowerCase().replace(' ', '-')">
              {{ element.status }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Assigned To Column -->
        <ng-container matColumnDef="assigned_to">
          <th mat-header-cell *matHeaderCellDef>Assigned To</th>
          <td mat-cell *matCellDef="let element">
            <span *ngIf="element.assigned_to_name">{{ element.assigned_to_name }}</span>
            <span *ngIf="!element.assigned_to_name" class="not-assigned">Not Assigned</span>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let element">
            <button mat-icon-button [matMenuTriggerFor]="menu">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="editEquipment(element)">
                <mat-icon>edit</mat-icon>
                <span>Edit</span>
              </button>
              <button mat-menu-item (click)="openAssignDialog(element)" *ngIf="element.status === 'Available'">
                <mat-icon>person_add</mat-icon>
                <span>Assign</span>
              </button>
              <button mat-menu-item (click)="unassignEquipment(element)" *ngIf="element.status === 'Assigned'">
                <mat-icon>person_remove</mat-icon>
                <span>Unassign</span>
              </button>
              <button mat-menu-item (click)="fileInput.click()">
                <mat-icon>upload_file</mat-icon>
                <span>Upload PAR</span>
                <input #fileInput type="file" accept=".pdf" style="display: none" (change)="onFileSelected($event, element)">
              </button>
              <button mat-menu-item (click)="downloadPAR(element)" *ngIf="element.par_file_path">
                <mat-icon>download</mat-icon>
                <span>Download PAR</span>
              </button>
              <mat-divider></mat-divider>
              <button mat-menu-item (click)="deleteEquipment(element)" class="delete-action">
                <mat-icon>delete</mat-icon>
                <span>Delete</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="equipmentList.length === 0">
        <mat-icon>computer</mat-icon>
        <h3>No Equipment Found</h3>
        <p>Click "Add Equipment" to get started</p>
      </div>
    </div>
  </div>
</div>

<style>
/* Main Wrapper */
.equipment-wrapper {
  padding: 30px 40px;
  background: #f5f7fb;
  min-height: 100vh;
}

/* Assignment Type Group */
.assignment-type-group {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-bottom: 20px;
  padding: 15px;
  background: #f5f7fb;
  border-radius: 8px;
}

.group-label {
  font-weight: 600;
  margin-bottom: 8px;
  color: #1f2937;
  font-size: 14px;
}

mat-radio-group {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

mat-radio-button {
  margin: 5px 0;
}

/* Info Box */
.info-box {
  display: flex;
  gap: 12px;
  padding: 15px;
  background: #e0f2fe;
  border-left: 4px solid #0284c7;
  border-radius: 8px;
  margin-top: 15px;
}

.info-box.par {
  background: #fef3c7;
  border-left-color: #f59e0b;
}

.info-box mat-icon {
  color: #0284c7;
  margin-top: 2px;
  font-size: 20px;
  width: 20px;
  height: 20px;
}

.info-box.par mat-icon {
  color: #f59e0b;
}

.info-text {
  flex: 1;
}

.info-text strong {
  display: block;
  margin-bottom: 5px;
  font-size: 14px;
}

.info-text p {
  margin: 0;
  font-size: 13px;
  color: #4b5563;
  line-height: 1.5;
}

/* Page Header */
.page-header {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 30px;
}

.back-btn {
  background: white;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.header-content {
  flex: 1;
}

.header-content h1 {
  font-size: 28px;
  font-weight: 600;
  color: #1f2937;
  margin: 0 0 8px 0;
  display: flex;
  align-items: center;
  gap: 12px;
}

.header-content p {
  color: #6b7280;
  font-size: 14px;
  margin: 0;
}

/* Messages */
.message-container {
  margin-bottom: 20px;
}

.success-alert, .error-alert {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 14px;
  margin-bottom: 10px;
}

.success-alert {
  background: #d4edda;
  border: 1px solid #c3e6cb;
  color: #155724;
}

.error-alert {
  background: #fee;
  border: 1px solid #fcc;
  color: #c33;
}

/* Form Card */
.form-card {
  background: white;
  border-radius: 16px;
  padding: 25px;
  margin-bottom: 30px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 2px solid #f3f4f6;
}

.form-header h3 {
  font-size: 20px;
  font-weight: 600;
  color: #1f2937;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.form-section {
  margin-bottom: 25px;
}

.form-section h4 {
  font-size: 16px;
  font-weight: 600;
  color: #4b5563;
  margin: 0 0 15px 0;
  display: flex;
  align-items: center;
  gap: 8px;
}

.form-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
  margin-bottom: 15px;
}

.full-width {
  grid-column: 1 / -1;
}

::ng-deep .mat-mdc-form-field {
  width: 100%;
}

.form-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  padding-top: 20px;
  border-top: 1px solid #f3f4f6;
}

.button-spinner {
  display: inline-block;
  margin-right: 8px;
}

::ng-deep .button-spinner circle {
  stroke: white;
}

/* Dialog Overlay */
.dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.dialog-content {
  background: white;
  border-radius: 16px;
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
}

.dialog-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 25px;
  border-bottom: 1px solid #f3f4f6;
}

.dialog-header h3 {
  font-size: 18px;
  font-weight: 600;
  color: #1f2937;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.dialog-body {
  padding: 25px;
}

.equipment-info {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  background: #f9fafb;
  border-radius: 8px;
  margin-bottom: 20px;
}

.equipment-info mat-icon {
  font-size: 40px;
  width: 40px;
  height: 40px;
  color: #6366f1;
}

.equipment-info div {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.equipment-info strong {
  font-size: 16px;
  color: #1f2937;
}

.equipment-info span {
  font-size: 14px;
  color: #6b7280;
}

.property-number {
  font-size: 12px !important;
  color: #9ca3af !important;
}

.dialog-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  padding: 20px 25px;
  border-top: 1px solid #f3f4f6;
}

/* Table Card */
.table-card {
  background: white;
  border-radius: 16px;
  padding: 25px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.table-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.table-header h3 {
  font-size: 18px;
  font-weight: 600;
  color: #1f2937;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.table-stats {
  display: flex;
  gap: 10px;
}

.stat-chip {
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 500;
}

.stat-chip.total {
  background: #e0e7ff;
  color: #4338ca;
}

.stat-chip.available {
  background: #d1fae5;
  color: #065f46;
}

.stat-chip.assigned {
  background: #fef3c7;
  color: #92400e;
}

/* Loading */
.loading-container {
  text-align: center;
  padding: 60px 20px;
}

.loading-container p {
  margin-top: 20px;
  color: #6b7280;
}

/* Table */
.table-container {
  overflow-x: auto;
}

.equipment-table {
  width: 100%;
}

.property-cell {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.property-cell strong {
  color: #1f2937;
  font-size: 14px;
}

.gsd-code {
  font-size: 12px;
  color: #9ca3af;
}

.not-assigned {
  color: #9ca3af;
  font-style: italic;
}

/* Status Chips */
::ng-deep .mat-mdc-chip {
  font-size: 12px;
  font-weight: 500;
  height: 28px;
}

::ng-deep .status-available {
  background: #d1fae5 !important;
  color: #065f46 !important;
}

::ng-deep .status-assigned {
  background: #dbeafe !important;
  color: #1e40af !important;
}

::ng-deep .status-under-repair {
  background: #fef3c7 !important;
  color: #92400e !important;
}

::ng-deep .status-disposed {
  background: #fee2e2 !important;
  color: #991b1b !important;
}

/* Menu Actions */
.delete-action {
  color: #dc2626;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #9ca3af;
}

.empty-state mat-icon {
  font-size: 80px;
  width: 80px;
  height: 80px;
  opacity: 0.3;
  margin-bottom: 15px;
}

.empty-state h3 {
  font-size: 18px;
  margin-bottom: 8px;
  color: #4b5563;
}

/* Responsive */
@media (max-width: 768px) {
  .equipment-wrapper {
    padding: 20px;
  }

  .page-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .form-row {
    grid-template-columns: 1fr;
  }

  .table-stats {
    flex-direction: column;
    gap: 5px;
  }
}
</style>