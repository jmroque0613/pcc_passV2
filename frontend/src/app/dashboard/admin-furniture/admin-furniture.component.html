<!-- frontend/src/app/dashboard/admin-furniture/admin-furniture.component.html -->
<div class="furniture-wrapper">
  <!-- Header -->
  <div class="page-header">
    <button mat-icon-button (click)="goBack()" class="back-btn">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <div class="header-content">
      <h1><mat-icon>chair</mat-icon> Furniture Management</h1>
      <p>Manage furniture & fixtures inventory and assignments</p>
    </div>
    <button mat-raised-button color="primary" (click)="showAddForm = !showAddForm; selectedFurniture = null; furnitureForm.reset({ condition: 'New', status: 'Available' })">
      <mat-icon>add</mat-icon>
      Add Furniture
    </button>
  </div>

  <!-- Success/Error Messages -->
  <div class="message-container" *ngIf="successMessage || errorMessage">
    <div class="success-alert" *ngIf="successMessage">
      <mat-icon>check_circle</mat-icon>
      <span>{{ successMessage }}</span>
    </div>
    <div class="error-alert" *ngIf="errorMessage">
      <mat-icon>error</mat-icon>
      <span>{{ errorMessage }}</span>
    </div>
  </div>

  <!-- Add/Edit Furniture Form -->
  <div class="form-card" *ngIf="showAddForm">
    <div class="form-header">
      <h3>
        <mat-icon>{{ selectedFurniture ? 'edit' : 'add_circle' }}</mat-icon>
        {{ selectedFurniture ? 'Edit Furniture' : 'Add New Furniture' }}
      </h3>
      <button mat-icon-button (click)="cancelForm()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <form [formGroup]="furnitureForm" (ngSubmit)="onSubmit()">
      <!-- Property Details Section -->
      <div class="form-section">
        <h4><mat-icon>description</mat-icon> Property Details</h4>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Property Number</mat-label>
            <input matInput formControlName="property_number" placeholder="PCC-2024-FUR-001">
            <mat-error *ngIf="furnitureForm.get('property_number')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>GSD Code</mat-label>
            <input matInput formControlName="gsd_code" placeholder="GSD-FUR-2024-001">
            <mat-error *ngIf="furnitureForm.get('gsd_code')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Item Number</mat-label>
            <input matInput formControlName="item_number" placeholder="FUR-001">
            <mat-error *ngIf="furnitureForm.get('item_number')?.hasError('required')">Required</mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Furniture Information Section -->
      <div class="form-section">
        <h4><mat-icon>chair</mat-icon> Furniture Information</h4>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Furniture Type</mat-label>
            <mat-select formControlName="furniture_type">
              <mat-option *ngFor="let type of furnitureTypes" [value]="type">{{ type }}</mat-option>
            </mat-select>
            <mat-error *ngIf="furnitureForm.get('furniture_type')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Description</mat-label>
            <input matInput formControlName="description" placeholder="Executive leather office chair">
            <mat-error *ngIf="furnitureForm.get('description')?.hasError('required')">Required</mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Brand (Optional)</mat-label>
            <input matInput formControlName="brand" placeholder="IKEA">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Material (Optional)</mat-label>
            <input matInput formControlName="material" placeholder="Wood, Metal, Plastic">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Color (Optional)</mat-label>
            <input matInput formControlName="color" placeholder="Black">
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Dimensions (Optional)</mat-label>
            <input matInput formControlName="dimensions" placeholder="120cm x 60cm x 75cm">
          </mat-form-field>
        </div>
      </div>

      <!-- Acquisition Details Section -->
      <div class="form-section">
        <h4><mat-icon>shopping_cart</mat-icon> Acquisition Details</h4>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Acquisition Date</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="acquisition_date">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="furnitureForm.get('acquisition_date')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Acquisition Cost (‚Ç±)</mat-label>
            <input matInput type="number" formControlName="acquisition_cost" placeholder="15000.00">
            <mat-error *ngIf="furnitureForm.get('acquisition_cost')?.hasError('required')">Required</mat-error>
            <mat-error *ngIf="furnitureForm.get('acquisition_cost')?.hasError('min')">Must be positive</mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Status & Condition Section -->
      <div class="form-section">
        <h4><mat-icon>info</mat-icon> Status & Condition</h4>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Condition</mat-label>
            <mat-select formControlName="condition">
              <mat-option *ngFor="let cond of conditions" [value]="cond">{{ cond }}</mat-option>
            </mat-select>
            <mat-error *ngIf="furnitureForm.get('condition')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Status</mat-label>
            <mat-select formControlName="status">
              <mat-option *ngFor="let stat of statuses" [value]="stat">{{ stat }}</mat-option>
            </mat-select>
            <mat-error *ngIf="furnitureForm.get('status')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Remarks (Optional)</mat-label>
            <textarea matInput formControlName="remarks" rows="2"></textarea>
          </mat-form-field>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button mat-button type="button" (click)="cancelForm()">Cancel</button>
        <button mat-raised-button color="primary" type="submit" [disabled]="loading">
          <mat-spinner *ngIf="loading" diameter="20" class="button-spinner"></mat-spinner>
          <span *ngIf="!loading">{{ selectedFurniture ? 'Update' : 'Add' }} Furniture</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Assign Furniture Dialog -->
  <div class="dialog-overlay" *ngIf="showAssignForm" (click)="cancelForm()">
    <div class="dialog-content" (click)="$event.stopPropagation()">
      <div class="dialog-header">
        <h3><mat-icon>person_add</mat-icon> Assign Furniture</h3>
        <button mat-icon-button (click)="cancelForm()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <form [formGroup]="assignForm" (ngSubmit)="onAssignSubmit()">
        <div class="dialog-body">
          <div class="furniture-info">
            <mat-icon>chair</mat-icon>
            <div>
              <strong>{{ selectedFurniture?.furniture_type }}</strong>
              <span>{{ selectedFurniture?.description }}</span>
              <span class="property-number">{{ selectedFurniture?.property_number }}</span>
            </div>
          </div>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Assign To User</mat-label>
            <mat-select formControlName="assigned_to_user_id">
              <mat-option *ngFor="let user of allUsers" [value]="user.id">
                {{ user.first_name }} {{ user.surname }} - {{ user.position }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="assignForm.get('assigned_to_user_id')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Assignment Date</mat-label>
            <input matInput [matDatepicker]="assignPicker" formControlName="assigned_date">
            <mat-datepicker-toggle matSuffix [for]="assignPicker"></mat-datepicker-toggle>
            <mat-datepicker #assignPicker></mat-datepicker>
            <mat-error *ngIf="assignForm.get('assigned_date')?.hasError('required')">Required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Location (Optional)</mat-label>
            <input matInput formControlName="location" placeholder="Room 201, 2nd Floor">
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>PAR Number (Optional)</mat-label>
            <input matInput formControlName="par_number" placeholder="PAR-2024-001">
          </mat-form-field>
        </div>

        <div class="dialog-actions">
          <button mat-button type="button" (click)="cancelForm()">Cancel</button>
          <button mat-raised-button color="primary" type="submit">Assign Furniture</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Furniture Table -->
  <div class="table-card">
    <div class="table-header">
      <h3><mat-icon>list</mat-icon> Furniture Inventory</h3>
      <div class="table-stats">
        <span class="stat-chip total">Total: {{ furnitureList.length }}</span>
        <span class="stat-chip available">Available: {{ (furnitureList | filter: 'status': 'Available').length }}</span>
        <span class="stat-chip assigned">Assigned: {{ (furnitureList | filter: 'status': 'Assigned').length }}</span>
      </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-container" *ngIf="loading">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading furniture...</p>
    </div>

    <!-- Furniture Table -->
    <div class="table-container" *ngIf="!loading">
      <table mat-table [dataSource]="furnitureList" class="furniture-table">
        <!-- Property Number Column -->
        <ng-container matColumnDef="property_number">
          <th mat-header-cell *matHeaderCellDef>Property Number</th>
          <td mat-cell *matCellDef="let element">
            <div class="property-cell">
              <strong>{{ element.property_number }}</strong>
              <span class="gsd-code">{{ element.gsd_code }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Furniture Type Column -->
        <ng-container matColumnDef="furniture_type">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let element">{{ element.furniture_type }}</td>
        </ng-container>

        <!-- Description Column -->
        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef>Description</th>
          <td mat-cell *matCellDef="let element">{{ element.description }}</td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let element">
            <mat-chip [class]="'status-' + element.status.toLowerCase().replace(' ', '-')">
              {{ element.status }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Assigned To Column -->
        <ng-container matColumnDef="assigned_to">
          <th mat-header-cell *matHeaderCellDef>Assigned To</th>
          <td mat-cell *matCellDef="let element">
            <div *ngIf="element.assigned_to_name">
              <span>{{ element.assigned_to_name }}</span>
              <span class="location" *ngIf="element.location">üìç {{ element.location }}</span>
            </div>
            <span *ngIf="!element.assigned_to_name" class="not-assigned">Not Assigned</span>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let element">
            <button mat-icon-button [matMenuTriggerFor]="menu">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="editFurniture(element)">
                <mat-icon>edit</mat-icon>
                <span>Edit</span>
              </button>
              <button mat-menu-item (click)="openAssignDialog(element)" *ngIf="element.status === 'Available'">
                <mat-icon>person_add</mat-icon>
                <span>Assign</span>
              </button>
              <button mat-menu-item (click)="unassignFurniture(element)" *ngIf="element.status === 'Assigned'">
                <mat-icon>person_remove</mat-icon>
                <span>Unassign</span>
              </button>
              <button mat-menu-item (click)="fileInput.click()">
                <mat-icon>upload_file</mat-icon>
                <span>Upload PAR</span>
                <input #fileInput type="file" accept=".pdf" style="display: none" (change)="onFileSelected($event, element)">
              </button>
              <button mat-menu-item (click)="downloadPAR(element)" *ngIf="element.par_file_path">
                <mat-icon>download</mat-icon>
                <span>Download PAR</span>
              </button>
              <mat-divider></mat-divider>
              <button mat-menu-item (click)="deleteFurniture(element)" class="delete-action">
                <mat-icon>delete</mat-icon>
                <span>Delete</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="furnitureList.length === 0">
        <mat-icon>chair</mat-icon>
        <h3>No Furniture Found</h3>
        <p>Click "Add Furniture" to get started</p>
      </div>
    </div>
  </div>
</div>

<style>
/* Main Wrapper */
.furniture-wrapper {
  padding: 30px 40px;
  background: #f5f7fb;
  min-height: 100vh;
}

/* Page Header */
.page-header {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 30px;
}

.back-btn {
  background: white;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.header-content {
  flex: 1;
}

.header-content h1 {
  font-size: 28px;
  font-weight: 600;
  color: #1f2937;
  margin: 0 0 8px 0;
  display: flex;
  align-items: center;
  gap: 12px;
}

.header-content p {
  color: #6b7280;
  font-size: 14px;
  margin: 0;
}

/* Messages */
.message-container {
  margin-bottom: 20px;
}

.success-alert, .error-alert {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 14px;
  margin-bottom: 10px;
}

.success-alert {
  background: #d4edda;
  border: 1px solid #c3e6cb;
  color: #155724;
}

.error-alert {
  background: #fee;
  border: 1px solid #fcc;
  color: #c33;
}

/* Form Card */
.form-card {
  background: white;
  border-radius: 16px;
  padding: 25px;
  margin-bottom: 30px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 2px solid #f3f4f6;
}

.form-header h3 {
  font-size: 20px;
  font-weight: 600;
  color: #1f2937;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.form-section {
  margin-bottom: 25px;
}

.form-section h4 {
  font-size: 16px;
  font-weight: 600;
  color: #4b5563;
  margin: 0 0 15px 0;
  display: flex;
  align-items: center;
  gap: 8px;
}

.form-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
  margin-bottom: 15px;
}

.full-width {
  grid-column: 1 / -1;
}

::ng-deep .mat-mdc-form-field {
  width: 100%;
}

.form-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  padding-top: 20px;
  border-top: 1px solid #f3f4f6;
}

.button-spinner {
  display: inline-block;
  margin-right: 8px;
}

::ng-deep .button-spinner circle {
  stroke: white;
}

/* Dialog Overlay */
.dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.dialog-content {
  background: white;
  border-radius: 16px;
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
}

.dialog-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 25px;
  border-bottom: 1px solid #f3f4f6;
}

.dialog-header h3 {
  font-size: 18px;
  font-weight: 600;
  color: #1f2937;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.dialog-body {
  padding: 25px;
}

.furniture-info {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  background: #f9fafb;
  border-radius: 8px;
  margin-bottom: 20px;
}

.furniture-info mat-icon {
  font-size: 40px;
  width: 40px;
  height: 40px;
  color: #f59e0b;
}

.furniture-info div {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.furniture-info strong {
  font-size: 16px;
  color: #1f2937;
}

.furniture-info span {
  font-size: 14px;
  color: #6b7280;
}

.property-number {
  font-size: 12px !important;
  color: #9ca3af !important;
}

.dialog-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  padding: 20px 25px;
  border-top: 1px solid #f3f4f6;
}

/* Table Card */
.table-card {
  background: white;
  border-radius: 16px;
  padding: 25px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.table-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.table-header h3 {
  font-size: 18px;
  font-weight: 600;
  color: #1f2937;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.table-stats {
  display: flex;
  gap: 10px;
}

.stat-chip {
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 500;
}

.stat-chip.total {
  background: #e0e7ff;
  color: #4338ca;
}

.stat-chip.available {
  background: #d1fae5;
  color: #065f46;
}

.stat-chip.assigned {
  background: #fef3c7;
  color: #92400e;
}

/* Loading */
.loading-container {
  text-align: center;
  padding: 60px 20px;
}

.loading-container p {
  margin-top: 20px;
  color: #6b7280;
}

/* Table */
.table-container {
  overflow-x: auto;
}

.furniture-table {
  width: 100%;
}

.property-cell {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.property-cell strong {
  color: #1f2937;
  font-size: 14px;
}

.gsd-code {
  font-size: 12px;
  color: #9ca3af;
}

.location {
  display: block;
  font-size: 12px;
  color: #6b7280;
  margin-top: 4px;
}

.not-assigned {
  color: #9ca3af;
  font-style: italic;
}

/* Status Chips */
::ng-deep .mat-mdc-chip {
  font-size: 12px;
  font-weight: 500;
  height: 28px;
}

::ng-deep .status-available {
  background: #d1fae5 !important;
  color: #065f46 !important;
}

::ng-deep .status-assigned {
  background: #dbeafe !important;
  color: #1e40af !important;
}

::ng-deep .status-under-repair {
  background: #fef3c7 !important;
  color: #92400e !important;
}

::ng-deep .status-disposed {
  background: #fee2e2 !important;
  color: #991b1b !important;
}

/* Menu Actions */
.delete-action {
  color: #dc2626;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #9ca3af;
}

.empty-state mat-icon {
  font-size: 80px;
  width: 80px;
  height: 80px;
  opacity: 0.3;
  margin-bottom: 15px;
}

.empty-state h3 {
  font-size: 18px;
  margin-bottom: 8px;
  color: #4b5563;
}

/* Responsive */
@media (max-width: 768px) {
  .furniture-wrapper {
    padding: 20px;
  }

  .page-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .form-row {
    grid-template-columns: 1fr;
  }

  .table-stats {
    flex-direction: column;
    gap: 5px;
  }
}
</style>